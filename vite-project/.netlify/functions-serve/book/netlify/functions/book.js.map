{
  "version": 3,
  "sources": ["../../../../../../../Users/nicnat/Projects/traverdecoraciontextil/vite-project/netlify/functions/book.js"],
  "sourceRoot": "/private/var/folders/8f/3rn3yv2d23l5nml9jvqwg7280000gn/T/tmp-46531-J0Tn0dMzuwQX",
  "sourcesContent": ["// netlify/functions/book.js\n// Server-side validation + normalized customer_key + atomic rate-limit via RPC allow_request\n// \u2705 IMPORTANT: bookings rows now store customer_key so bookings merge in admin history.\n\nfunction json(statusCode, bodyObj) {\n  return {\n    statusCode,\n    headers: {\n      \"Content-Type\": \"application/json; charset=utf-8\",\n      \"Cache-Control\": \"no-store\",\n    },\n    body: JSON.stringify(bodyObj, null, 2),\n  };\n}\n\nfunction overlaps(aStartMs, aEndMs, bStartMs, bEndMs) {\n  return aStartMs < bEndMs && aEndMs > bStartMs;\n}\n\nasync function supabaseGet({ url, serviceKey, path }) {\n  const res = await fetch(`${url}/rest/v1/${path}`, {\n    headers: {\n      apikey: serviceKey,\n      Authorization: `Bearer ${serviceKey}`,\n      \"Content-Type\": \"application/json\",\n    },\n  });\n  const text = await res.text();\n  if (!res.ok) throw new Error(`Supabase GET failed: ${res.status} ${text}`);\n  return text ? JSON.parse(text) : [];\n}\n\nasync function supabaseInsert({ url, serviceKey, table, row }) {\n  const res = await fetch(`${url}/rest/v1/${table}`, {\n    method: \"POST\",\n    headers: {\n      apikey: serviceKey,\n      Authorization: `Bearer ${serviceKey}`,\n      \"Content-Type\": \"application/json\",\n      Prefer: \"return=representation\",\n    },\n    body: JSON.stringify(row),\n  });\n  const text = await res.text();\n  if (!res.ok) throw new Error(`Supabase INSERT failed: ${res.status} ${text}`);\n  return text ? JSON.parse(text) : [];\n}\n\nasync function supabaseUpsert({ url, serviceKey, table, row, onConflict }) {\n  const res = await fetch(\n    `${url}/rest/v1/${table}?on_conflict=${encodeURIComponent(onConflict)}`,\n    {\n      method: \"POST\",\n      headers: {\n        apikey: serviceKey,\n        Authorization: `Bearer ${serviceKey}`,\n        \"Content-Type\": \"application/json\",\n        Prefer: \"resolution=merge-duplicates,return=representation\",\n      },\n      body: JSON.stringify(row),\n    }\n  );\n\n  const text = await res.text();\n  if (!res.ok) throw new Error(`Supabase UPSERT failed: ${res.status} ${text}`);\n  return text ? JSON.parse(text) : [];\n}\n\n// \u2705 Submit to Netlify Forms so Netlify triggers email notifications\nasync function submitToNetlifyForms(formName, fields) {\n  const siteUrl = process.env.URL || process.env.DEPLOY_PRIME_URL;\n  if (!siteUrl) throw new Error(\"Missing site URL env (URL/DEPLOY_PRIME_URL)\");\n\n  const body = new URLSearchParams({\n    \"form-name\": formName,\n    ...fields,\n  }).toString();\n\n  const res = await fetch(siteUrl + \"/\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n    body,\n  });\n\n  // Netlify often responds 200/302. Treat non-2xx/3xx as failure.\n  if (!(res.status >= 200 && res.status < 400)) {\n    const t = await res.text().catch(() => \"\");\n    throw new Error(`Netlify Forms submit failed: ${res.status} ${t}`);\n  }\n\n  return true;\n}\n\nfunction normalizeSpanishPhone(input) {\n  const digits = String(input || \"\").replace(/\\D/g, \"\");\n  if (!/^[6789]\\d{8}$/.test(digits)) return null;\n  return digits;\n}\n\nfunction parseRpcBoolean(rpcJson) {\n  // can be: true | false | [{ allow_request: true }] | { allow_request: true }\n  if (rpcJson === true || rpcJson === false) return rpcJson;\n  if (Array.isArray(rpcJson)) return rpcJson[0]?.allow_request;\n  return rpcJson?.allow_request;\n}\n\nasync function rateLimitHourly({\n  supabaseUrl,\n  serviceKey,\n  customer_key,\n  maxPerHour = 2,\n}) {\n  const rpcRes = await fetch(`${supabaseUrl}/rest/v1/rpc/allow_request`, {\n    method: \"POST\",\n    headers: {\n      apikey: serviceKey,\n      Authorization: `Bearer ${serviceKey}`,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      p_customer_key: customer_key,\n      p_max: maxPerHour,\n      p_window_minutes: 60,\n    }),\n  });\n\n  const rpcJson = await rpcRes.json().catch(() => null);\n  const allowed = parseRpcBoolean(rpcJson);\n\n  if (!rpcRes.ok || allowed !== true) {\n    return {\n      ok: false,\n      statusCode: 429,\n      body: {\n        error: \"Has alcanzado el l\u00EDmite: m\u00E1ximo 2 solicitudes por hora.\",\n        code: \"RATE_LIMIT_HOURLY\",\n      },\n    };\n  }\n\n  return { ok: true };\n}\n\nexport async function handler(event) {\n  try {\n    if (event.httpMethod !== \"POST\") {\n      return json(405, { error: \"Use POST\" });\n    }\n\n    const SUPABASE_URL = process.env.SUPABASE_URL;\n    const SERVICE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!SUPABASE_URL || !SERVICE_KEY) {\n      return json(500, {\n        error: \"Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\",\n      });\n    }\n\n    let payload;\n    try {\n      payload = JSON.parse(event.body || \"{}\");\n    } catch {\n      return json(400, { error: \"Invalid JSON body\" });\n    }\n\n    const {\n      pack = \"Sin especificar\",\n      customer_name,\n      phone,\n      email = null,\n      contact_preference = \"WhatsApp\",\n      message = \"\",\n      home_visit = false,\n      address_line1 = null,\n      postal_code = null,\n      city = null,\n      address_notes = null,\n      start, // client sends UTC ISO from availability endpoint\n    } = payload;\n\n    // ---- Validate + normalize ----\n    const name = String(customer_name || \"\").trim();\n    if (!name) return json(400, { error: \"Missing customer_name\" });\n\n    // Phone is REQUIRED for bookings (DB phone is NOT NULL)\n    const phoneNorm = normalizeSpanishPhone(phone);\n    if (!phoneNorm) {\n      return json(400, {\n        error:\n          \"Provide a valid Spanish phone number (9 digits, starts 6/7/8/9)\",\n      });\n    }\n\n    // Email is optional\n    const emailLower = email ? String(email).trim().toLowerCase() : null;\n\n    // \u2705 Canonical key: email first if present, else phone digits\n    const customer_key = emailLower || phoneNorm;\n\n    if (!start) return json(400, { error: \"Missing start\" });\n\n    if (home_visit) {\n      if (!address_line1 || !postal_code || !city) {\n        return json(400, {\n          error:\n            \"Missing address fields for home_visit (address_line1, postal_code, city)\",\n        });\n      }\n    }\n\n    const startDate = new Date(start);\n    if (Number.isNaN(startDate.getTime())) {\n      return json(400, { error: \"Invalid start datetime\" });\n    }\n\n    // Enforce lead time (2 days) - server-side re-check\n    const leadTimeDays = 2;\n    const minStart = Date.now() + leadTimeDays * 24 * 60 * 60_000;\n    if (startDate.getTime() < minStart) {\n      return json(400, {\n        error: \"Selected slot is too soon (lead time enforced).\",\n      });\n    }\n\n    const pref = String(contact_preference || \"WhatsApp\").trim();\n\n    // ---- Rate limit (atomic, hourly) ----\n    const rl = await rateLimitHourly({\n      supabaseUrl: SUPABASE_URL,\n      serviceKey: SERVICE_KEY,\n      customer_key,\n      maxPerHour: 2,\n    });\n    if (!rl.ok) return json(rl.statusCode, rl.body);\n\n    // Booking blocks 2 hours\n    const blockMinutes = 120;\n    const endDate = new Date(startDate.getTime() + blockMinutes * 60_000);\n\n    const startIso = startDate.toISOString();\n    const endIso = endDate.toISOString();\n\n    // Pull any overlapping reserved bookings & blackouts in the slot window\n    // Query: start_time < end AND end_time > start\n    const reserved = await supabaseGet({\n      url: SUPABASE_URL,\n      serviceKey: SERVICE_KEY,\n      path:\n        `bookings?select=id,start_time,end_time,status` +\n        `&status=eq.reserved` +\n        `&start_time=lt.${encodeURIComponent(endIso)}` +\n        `&end_time=gt.${encodeURIComponent(startIso)}`,\n    });\n\n    const blackouts = await supabaseGet({\n      url: SUPABASE_URL,\n      serviceKey: SERVICE_KEY,\n      path:\n        `blackouts?select=id,start_time,end_time,reason` +\n        `&start_time=lt.${encodeURIComponent(endIso)}` +\n        `&end_time=gt.${encodeURIComponent(startIso)}`,\n    });\n\n    // Double-check overlaps (defensive)\n    const startMs = startDate.getTime();\n    const endMs = endDate.getTime();\n\n    const busy = []\n      .concat(\n        reserved.map((b) => ({\n          kind: \"booking\",\n          startMs: new Date(b.start_time).getTime(),\n          endMs: new Date(b.end_time).getTime(),\n        }))\n      )\n      .concat(\n        blackouts.map((b) => ({\n          kind: \"blackout\",\n          startMs: new Date(b.start_time).getTime(),\n          endMs: new Date(b.end_time).getTime(),\n        }))\n      );\n\n    const blocked = busy.some((r) =>\n      overlaps(startMs, endMs, r.startMs, r.endMs)\n    );\n    if (blocked) {\n      return json(409, {\n        error: \"Slot unavailable\",\n        code: \"SLOT_TAKEN\",\n      });\n    }\n\n    // ---- 1) Insert booking row ----\n    // \u2705 IMPORTANT: write customer_key to bookings (so admin can merge history reliably)\n    const inserted = await supabaseInsert({\n      url: SUPABASE_URL,\n      serviceKey: SERVICE_KEY,\n      table: \"bookings\",\n      row: {\n        customer_key,\n        status: \"reserved\",\n        meeting_mode: home_visit ? \"domicilio\" : \"tienda\",\n        pack,\n        customer_name: name,\n        phone: phoneNorm, // normalized digits or null\n        email: emailLower, // lowercase or null\n        contact_preference: pref,\n        home_visit: !!home_visit,\n        address_line1,\n        postal_code,\n        city,\n        address_notes,\n        start_time: startIso,\n        end_time: endIso,\n        message,\n      },\n    });\n    // ---- 1b) Insert contact history row (for timeline / names / messages) ----\n    await supabaseInsert({\n      url: SUPABASE_URL,\n      serviceKey: SERVICE_KEY,\n      table: \"customer_contacts\",\n      row: {\n        customer_key,\n        customer_name: name,\n        phone: phoneNorm,\n        email: emailLower,\n        message,\n        source: \"booking\",\n      },\n    });\n\n    // ---- 2) Upsert customer row ----\n    await supabaseUpsert({\n      url: SUPABASE_URL,\n      serviceKey: SERVICE_KEY,\n      table: \"customers\",\n      onConflict: \"customer_key\",\n      row: {\n        customer_key,\n        status: \"nuevo\",\n        name,\n        phone: phoneNorm,\n        email: emailLower,\n        city: city || null,\n        updated_at: new Date().toISOString(),\n      },\n    });\n\n    // ---- 3) Netlify email (non-blocking) ----\n    let netlifyWarning = null;\n    try {\n      await submitToNetlifyForms(\"asesoramiento\", {\n        meeting_mode: home_visit ? \"domicilio\" : \"tienda\",\n        pack,\n        nombre: name,\n        telefono: phoneNorm || \"\",\n        email: emailLower || \"\",\n        preferencia: pref,\n        mensaje: message || \"\",\n        start_time: startIso,\n        end_time: endIso,\n        address_line1: address_line1 || \"\",\n        postal_code: postal_code || \"\",\n        city: city || \"\",\n        address_notes: address_notes || \"\",\n        kind: \"booking\",\n      });\n    } catch (e) {\n      netlifyWarning = e?.message || String(e);\n    }\n\n    return json(200, {\n      ok: true,\n      booking: inserted?.[0] || null,\n      start: startIso,\n      end: endIso,\n      blockMinutes,\n      customer_key,\n      netlifyWarning,\n    });\n  } catch (err) {\n    return json(500, { error: err?.message || \"Unknown error\" });\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
